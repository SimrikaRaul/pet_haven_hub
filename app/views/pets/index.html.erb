<div class="container mx-auto px-4 py-8">
  <header class="mb-6 flex items-center justify-between">
    <h1 class="text-3xl font-extrabold text-gray-900">Browse Available Pets</h1>
    <div class="hidden sm:flex items-center gap-3">
      <%= link_to 'Add Pet', new_pet_path, class: 'inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg shadow-sm hover:bg-blue-700 transition' if user_signed_in? %>
    </div>
  </header>

  <div class="row flex flex-col lg:flex-row gap-6">
    <!-- Filters / Sidebar -->
    <aside class="w-full lg:w-1/4 bg-white rounded-lg shadow-md p-4">
      <h2 class="text-lg font-semibold mb-3">Filters</h2>
      <%= form_with url: pets_path, method: :get, local: true do |f| %>
        <div class="mb-3">
          <%= f.label :species, 'Species', class: 'block text-sm font-medium text-gray-700 mb-1' %>
          <%= f.select :species, options_for_select([['All', ''], ['Dog','dog'], ['Cat','cat'], ['Rabbit','rabbit'], ['Bird','bird'], ['Other','other']], params[:species]), {}, class: 'form-control px-3 py-2 border rounded-md w-full' %>
        </div>

        <div class="mb-3">
          <%= f.label :breed, 'Breed', class: 'block text-sm font-medium text-gray-700 mb-1' %>
          <%= f.text_field :breed, value: params[:breed], placeholder: 'e.g., Golden Retriever', class: 'form-control px-3 py-2 border rounded-md w-full' %>
        </div>

        <div class="mb-3">
          <%= f.label :max_age, 'Max age (years)', class: 'block text-sm font-medium text-gray-700 mb-1' %>
          <%= f.number_field :max_age, value: params[:max_age], class: 'form-control px-3 py-2 border rounded-md w-full' %>
        </div>

        <div class="mb-3">
          <%= f.label :size, 'Size', class: 'block text-sm font-medium text-gray-700 mb-1' %>
          <%= f.select :size, options_for_select([['Any',''], ['Small','small'], ['Medium','medium'], ['Large','large']], params[:size]), {}, class: 'form-control px-3 py-2 border rounded-md w-full' %>
        </div>

        <div class="mb-4 flex items-center gap-2">
          <%= f.check_box :available, {}, '1', '0', class: 'h-4 w-4 text-blue-600' %>
          <%= f.label :available, 'Available only', class: 'text-sm text-gray-700' %>
        </div>

        <div class="flex gap-2">
          <%= f.submit 'Apply', class: 'w-1/2 inline-block text-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition' %>
          <%= link_to 'Clear', pets_path, class: 'w-1/2 inline-block text-center px-4 py-2 border border-gray-300 rounded-md bg-white hover:bg-gray-50' %>
        </div>
      <% end %>
    </aside>

    <!-- Main content -->
    <main class="w-full lg:w-3/4">
      <% if @pets.any? %>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
          <% @pets.each do |pet| %>
            <article class="bg-white rounded-lg shadow hover:shadow-lg transition overflow-hidden flex flex-col">
              <div class="h-48 bg-gray-100 flex items-center justify-center overflow-hidden">
                <% if pet.image.present? && pet.image.url %>
                  <%= link_to pet_path(pet) do %>
                    <%= image_tag pet.image.url, alt: pet.name, class: 'w-full h-full object-cover' %>
                  <% end %>
                <% else %>
                  <%= link_to pet_path(pet) do %>
                    <%= image_tag '/images/placeholder-pet.jpg', alt: 'Placeholder', class: 'w-full h-full object-cover' %>
                  <% end %>
                <% end %>
              </div>

              <div class="p-4 flex-1 flex flex-col">
                <div class="mb-2">
                  <h3 class="text-xl font-semibold text-gray-900"><%= pet.name %></h3>
                  <p class="text-sm text-gray-600"> <strong><%= pet.pet_type.try(:capitalize) %></strong> ‚Ä¢ <%= pet.breed %> ‚Ä¢ <%= pet.age %> yrs</p>
                </div>

                <p class="text-sm text-gray-500 mb-4 truncate">üìç <%= pet.location %></p>

                <div class="mt-auto flex gap-2">
                  <%= link_to 'View', pet_path(pet), class: 'flex-1 inline-flex justify-center items-center px-3 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition' %>
                  <% if user_signed_in? %>
                    <%= button_to 'Adopt', pet_requests_path(pet), method: :post, params: { request: { request_type: 'adopt' } }, class: 'flex-1 inline-flex justify-center items-center px-3 py-2 border border-indigo-600 text-indigo-600 rounded-md hover:bg-indigo-50 transition' %>
                  <% else %>
                    <%= link_to 'Sign in', new_user_session_path, class: 'flex-1 inline-flex justify-center items-center px-3 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition' %>
                  <% end %>
                </div>
              </div>
            </article>
          <% end %>
        </div>

        <div class="mt-6 flex justify-center">
          <%= paginate @pets, theme: 'bootstrap-4' %>
        </div>
      <% else %>
        <div class="bg-white rounded-lg shadow p-8 text-center">
          <h3 class="text-xl font-semibold mb-2">No pets found</h3>
          <p class="text-gray-600 mb-4">Try adjusting your filters or check back later.</p>
          <%= link_to 'Reset filters', pets_path, class: 'inline-block px-4 py-2 bg-gray-100 border rounded-md' %>
        </div>
      <% end %>
    </main>
  </div>
</div>
